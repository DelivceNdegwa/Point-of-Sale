#: import Factory kivy.factory.Factory


<Pos>:
    BoxLayout:
        orientation: 'vertical'
        size_hint_x: .7
        spacing: dp(12)
        padding: [dp(14), dp(0)]
        BoxLayout:
            spacing: dp(12)
            size_hint_y: None
            height: dp(128)
            BoxLayout:
                size_hint_x: None
                width: self.height
                Image:
                    source:"assets/imgs/logo-light.png"
            AnchorLayout:
                anchor_x: 'left'
                padding: [dp(24), dp(4)]
                BackBox:
                    bcolor: app.color_secondary_bg
                    radius: [self.height*.1]
                    padding: [dp(12), 0]
                    size_hint_y: None
                    height: dp(54)
                    Text:
                        color: app.color_secondary_text
                        text: icon("icon-search")
                        size_hint_x: None
                        width: self.height
                        font_size: app.fonts.size.h1
                        halign: "center"
                        valign: "middle"

                    SearchBar:
                        id: product_search
                        hint_text: "Search by product name or code"
                        callback: root.add_product
        BoxLayout:
            spacing: dp(12)
            orientation: 'vertical'
            padding: [0,0, dp(24), 0]
            BackBox:
                size_hint_y: None
                height: dp(48)
                bcolor: app.color_secondary_bg
                spacing: dp(12)
                padding: [dp(12), dp(2)]
                radius: [self.height*.1]
                Text:
                    text: 'ID'
                    font_size: app.fonts.size.h3
                    font_name: app.fonts.heading
                    color: app.color_primary_text
                    valign: "middle"
                    size_hint_x: .125
                Text:
                    text: 'Product'
                    font_size: app.fonts.size.h3
                    font_name: app.fonts.heading
                    color: app.color_primary_text
                    valign: "middle"
                    size_hint_x: .375
                Text:
                    text: 'Qty'
                    font_size: app.fonts.size.h3
                    font_name: app.fonts.heading
                    halign: "center"
                    color: app.color_primary_text
                    valign: "middle"
                    size_hint_x: .125
                Text:
                    text: 'Each'
                    font_size: app.fonts.size.h3
                    font_name: app.fonts.heading
                    color: app.color_primary_text
                    valign: "middle"
                    halign: "center"
                    size_hint_x: .125
                Text:
                    text: 'Amount'
                    font_size: app.fonts.size.h3
                    font_name: app.fonts.heading
                    color: app.color_primary_text
                    valign: "middle"
                    halign: "center"
                    size_hint_x: .125
                Text:
                    text: 'Action'
                    font_size: app.fonts.size.h3
                    font_name: app.fonts.heading
                    color: app.color_primary_text
                    valign: "middle"
                    halign: "center"
                    size_hint_x: .125
            BoxLayout:
                ScrollView:
                    effect_cls: 'ScrollEffect'
                    do_scroll: [False, True] #Scroll on the Y axis
                    size_hint_y: None
                    height: self.parent.height
                    GridLayout:
                        id: gl_products
                        cols: 1
                        size_hint_y: None
                        height: self.minimum_height
                        spacing: dp(12)


    BackBox:
        orientation: 'vertical'
        size_hint_x: .3
        bcolor: app.color_alternate
        spacing: dp(12)
        padding: [0, 0, 0, dp(12)]
        BoxLayout:
            size_hint_y: None
            height: dp(64)
            spacing: dp(12)
            padding: [dp(12), dp(0)]
            FlatButton:
                text: icon("icon-bell")
                color: app.color_primary_text
                font_size: app.fonts.size.h1
                size_hint_x: None
                valign: "middle"
                width: self.height
            Widget:
            BoxLayout:
                RelativeLayout:
                    Text:
                        text: icon("icon-chevron-down")
                        color: app.color_primary_text
                        font_size: app.fonts.size.h2
                        halign: "right"
                    BoxLayout:
                        padding: [0, 0, dp(24) ,0]
                        Spinner:
                            text: root.username
                            font_name: app.fonts.styled
                            color: app.color_primary_text
                            font_size: app.fonts.size.h3
                            text_size: self.size
                            halign: "right"
                            valign: "middle"
                            values: ["Profile", "Logout"]
                            background_normal: ""
                            background_down: ""
                            background_color: [0,0,0,0]
        Divider:
            id: hr
        BoxLayout:
            orientation: 'vertical'
            spacing: dp(8)
            BoxLayout:
                size_hint_y: None
                height: dp(20)
                Text:
                    text:'Current Cart'
                    color: app.color_primary
                    font_size: app.fonts.size.h3
                    halign: "center"
            BoxLayout:
                orientation: 'vertical'
                spacing: dp(8)
                padding: dp(12)
                BoxLayout:
                    id: header_box
                    spacing: dp(4)
                    size_hint_y: None
                    height: dp(24)
                    Text:
                        text:'Product'
                        color: app.color_primary_text
                        font_size: app.fonts.size.h3
                        halign: "left"
                        size_hint_x: .4
                    Text:
                        text:'Qty'
                        color: app.color_primary_text
                        font_size: app.fonts.size.h3
                        halign: "center"
                        size_hint_x: .2
                    Text:
                        text:'Each'
                        color: app.color_primary_text
                        font_size: app.fonts.size.h3
                        halign: "right"   
                        size_hint_x: .2
                    Text:
                        text:'Amount'
                        color: app.color_primary_text
                        font_size: app.fonts.size.h3
                        halign: "right"   
                        size_hint_x: .2  
                Divider: 
                BoxLayout:
                    ScrollView:
                        do_scroll: [False, True]
                        size_hint_y: None
                        height: self.parent.height
                        GridLayout:
                            id: gl_receipt
                            cols: 1
                            spacing: dp(8)
                            size_hint_y: None
                            height: self.minimum_height
        Divider:
            id: hr
        BoxLayout:
            size_hint_y: None
            height: dp(95)*2 
            padding: [dp(12), 0]
            orientation:'vertical'
            spacing: dp(8)
            BoxLayout:
                spacing: dp(12)
                Text:
                    text:'AMOUNT DUE'
                    font_name: app.fonts.heading
                    font_size: app.fonts.size.h3
                    color: app.color_primary_text
                    halign: "left"
                Text:
                    text: f"KES {round(root.current_total, 2)}"
                    font_name: app.fonts.heading
                    font_size: app.fonts.size.h3
                    color: app.color_primary_text
                    halign: "right"
            BoxLayout:
                size_hint_x: 1
                spacing: dp(12)
                Text:
                    size_hint_x: .5
                    text: 'TENDERED'
                    font_name: app.fonts.heading
                    font_size: app.fonts.size.h3
                    color: app.color_primary_text
                    halign: "left"
                BoxLayout:
                    bcolor: app.color_primary_bg
                    size_hint_x: .5
                    FlatField:
                        id: amount_tendered
                        hint_text: "100.0"
                        font_name: app.fonts.heading
                        font_size: app.fonts.size.h3
                        input_filter: "int"
                        halign: "right"
            BoxLayout:
                spacing: dp(12)
                Text:
                    text:'CHANGE'
                    font_name: app.fonts.heading
                    font_size: app.fonts.size.h3
                    color: app.color_primary_text
                    halign: "left"
                Text:
                    text: f"KES 0.0"
                    font_name: app.fonts.heading
                    font_size: app.fonts.size.h3
                    color: app.color_primary_text
                    halign: "right"

            RoundedButton:
                text: "Print Receipt"
                font_name: app.fonts.heading
                font_size: app.fonts.size.h3
                color: rgba("#ffffff")
                radius: [self.height*.1]
                bcolor: app.color_primary

<Divider@Widget>:
    size_hint_y: None
    height: dp(1.2)
    canvas.before:
        Color:
            rgba: rgba("#dedede")
        Rectangle:
            pos: self.pos
            size: self.size


<ProductTile>:
    size_hint_y: None
    height: dp(48)
    bcolor: app.color_secondary_bg
    spacing: dp(12)
    padding: [dp(12), dp(2)]
    canvas.after:
        Color:
            rgba: app.color_secondary_bg
        Rectangle:
            pos: self.pos
            size: [self.size[0], dp(1)]
    Text:
        text: root.product_code
        font_size: app.fonts.size.h3
        font_name: app.fonts.body
        color: app.color_primary_text
        valign: "middle"
        size_hint_x: .125
    Text:
        text: root.product_name
        font_size: app.fonts.size.h3
        font_name: app.fonts.body
        color: app.color_primary_text
        valign: "middle"
        size_hint_x: .35
    BackBox:
        size_hint_x: .15
        FlatButton:
            text: icon("icon-minus-circle")
            color: app.color_tertiary
            font_size: app.fonts.size.h1
            on_release: root.quantity_callback(root, False) if root.quantity_callback else print
        Text:
            text: str(root.product_quantity)
            font_size: app.fonts.size.h3
            font_name: app.fonts.heading
            color: app.color_primary_text
            valign: "middle"
            halign: "center"
        FlatButton:
            text: icon("icon-plus-circle")
            color: app.color_secondary
            font_size: app.fonts.size.h1
            on_release: root.quantity_callback(root, True) if root.quantity_callback else print
    Text:
        text: str(round(root.product_price, 2))
        font_size: app.fonts.size.h3
        font_name: app.fonts.body
        color: app.color_primary_text
        valign: "middle"
        halign: "center"
        size_hint_x: .125
    Text:
        text: str(round(root.price_total, 2))
        font_size: app.fonts.size.h3
        font_name: app.fonts.body
        color: app.color_primary_text
        valign: "middle"
        halign: "center"
        size_hint_x: .125
    BackBox:
        size_hint_x: .125
        valign: "middle"
        halign: "center"
        FlatButton:
            text: icon("icon-trash-2")
            color: app.color_tertiary
            font_size: app.fonts.size.h1
            on_release: root.product_remove(root) if root.product_remove else print


<ReceiptItem>
    spacing: dp(4)
    size_hint_y: None
    height: dp(24)
    Text:
        text: root.product_name
        color: app.color_primary_text
        font_size: app.fonts.size.h4
        font_name: app.fonts.body
        halign: "left"
        size_hint_x: .4
    Text:
        text: f"X{root.product_quantity}"
        color: app.color_primary_text
        font_size: app.fonts.size.h4
        font_name: app.fonts.body
        halign: "center"
        size_hint_x: .2
    Text:
        text: str(round(root.product_price, 2))
        color: app.color_primary_text
        font_size: app.fonts.size.h4
        halign: "right"
        size_hint_x: .2
    Text:
        text: str(round(root.price_total, 2))
        color: app.color_primary_text
        font_size: app.fonts.size.h4
        halign: "right"   
        size_hint_x: .2 